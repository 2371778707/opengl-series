#version 150

uniform mat4 model;
uniform mat4 view;
uniform sampler2D tex;

uniform struct Light {
   vec4 position;
   vec3 color; //a.k.a intensity
} light;

in vec2 fragTexCoord;
in vec3 fragNormal;
in vec3 fragVert;

out vec4 finalColor;

void main() {
    vec3 normal = normalize(transpose(inverse(mat3(view * model))) * fragNormal);
    
    vec3 directionToLight;
    if(light.position.w == 0){
        directionToLight = normalize(vec3(view * light.position));
    } else {
        vec3 lightPos = vec3(view * light.position);
        directionToLight = normalize(lightPos - fragVert);
    }

    float cosAngIncidence = clamp(dot(normal, directionToLight), 0, 1);

    finalColor = cosAngIncidence * vec4(light.color, 1) * texture(tex, fragTexCoord);
}